<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üíê A Question</title>
  <style>
    :root{
      --ink:#1e1e2d;
      --card: rgba(255,255,255,0.78);
      --border: rgba(255,255,255,0.65);
      --shadow: 0 22px 60px rgba(0,0,0,.14);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background: radial-gradient(1200px 700px at 20% 25%, #ffffff 0%, #fff1f7 35%, #ffe6f1 100%);
    }
    canvas{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      display:block;
    }

    /* UI overlay */
    .ui{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      opacity:0;
      transform: translateY(8px);
      transition: opacity .8s ease, transform .8s ease;
    }
    .ui.show{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    .card{
      width:min(520px, 92vw);
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px;
    }
    h1{
      margin: 6px 0 0;
      font-size: clamp(36px, 5vw, 52px);
      line-height: 1.02;
      letter-spacing: -0.6px;
    }
    .subtitle{
      margin: 10px 0 14px;
      opacity:.78;
      font-size: 15px;
    }

    .meme{
      width:100%;
      height: 420px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(255,210,230,.8), rgba(255,238,247,.9));
      border: 1px dashed rgba(255,79,164,.55);
      display:grid;
      place-items:center;
      overflow:hidden;
      position:relative;
      margin: 12px 0 16px;
    }
    .meme img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
    }
    .meme .hint{
      text-align:center;
      padding: 0 18px;
      color:#6f3f5a;
      font-size: 14px;
      line-height:1.35;
    }

    .btn-row{
      display:flex;
      gap: 12px;
      justify-content:center;
      margin-top: 6px;
    }
    button{
      border:none;
      border-radius: 18px;
      padding: 14px 18px;
      font-weight:800;
      font-size: 18px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    button:active{ transform: scale(.98); }
    .yes{
      background: linear-gradient(135deg, #ff4fa4, #ff78bd);
      color:white;
      width: 180px;
      box-shadow: 0 14px 30px rgba(255,79,164,.30);
    }
    .yes:hover{ filter: brightness(1.03); }

    .accepted{
      display:none;
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(255,79,164,.10);
      border: 1px solid rgba(255,79,164,.25);
      font-weight: 750;
      text-align:center;
    }
    .accepted.show{ display:block; }

    .tiny{
      font-size: 13px;
      opacity:.72;
      text-align:center;
      margin-top: 12px;
    }

    /* celebration hearts (DOM particles) */
    .pop-heart{
      position:fixed;
      width:16px; height:16px;
      transform: rotate(45deg);
      pointer-events:none;
      z-index: 9999;
      background: #ff4fa4;
    }
    .pop-heart:before,.pop-heart:after{
      content:"";
      position:absolute;
      width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .pop-heart:before{ left:-8px; top:0;}
    .pop-heart:after{ left:0; top:-8px;}
  </style>
</head>

<body>
  <canvas id="c"></canvas>

  <div class="ui" id="ui">
    <div class="card">
      <h1 id="q1">Sharada, will you</h1>
      <h1 id="q2" style="margin-top:-6px;">be my Valentine?</h1>

      <div class="meme">
        <video autoplay loop muted playsinline
               style="width:100%;height:100%;object-fit:cover;border-radius:18px;">
          <source src="spongebob-squarepants-begging.mp4" type="video/mp4">
        </video>
      </div>

      <div class="btn-row">
        <button class="yes" id="yesBtn">YES YES YES</button>
      </div>

      <div class="accepted" id="accepted">
        YAYYYYY üíû<br/>Okay, now I owe you a bouquet
      </div>

    </div>
  </div>

  <script>
    // ---------------------------
    // Optional meme load
    // ---------------------------
    (function loadMeme(){
      const img = document.getElementById('memeImg');
      const hint = document.getElementById('memeHint');
      const files = ['meme.gif','meme.png','meme.jpg','meme.jpeg'];
      let i = 0;
      function next(){
        if(i >= files.length) return;
        const src = files[i++];
        const probe = new Image();
        probe.onload = () => { img.src = src; img.style.display = 'block'; hint.style.display = 'none'; };
        probe.onerror = next;
        probe.src = src;
      }
      next();
    })();

    // ---------------------------
    // Canvas setup
    // ---------------------------
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');

    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = "100vw";
      canvas.style.height = "100vh";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // draw in CSS pixels
    }
    window.addEventListener('resize', resize);
    resize();

    const ui = document.getElementById('ui');

    // ---------------------------
    // Math helpers
    // ---------------------------
    const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
    const lerp  = (a,b,t)=>a+(b-a)*t;
    const smoothstep = (t)=>{ t=clamp(t,0,1); return t*t*(3-2*t); };

    // Background sparkly hearts (canvas)
    function drawTinyHeart(x,y,s,rot,alpha, color){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = color;
      ctx.beginPath();
      // heart-ish shape using bezier
      ctx.moveTo(0, s*0.3);
      ctx.bezierCurveTo(-s*0.6, -s*0.3, -s*0.7, s*0.55, 0, s*0.9);
      ctx.bezierCurveTo(s*0.7, s*0.55, s*0.6, -s*0.3, 0, s*0.3);
      ctx.fill();
      ctx.restore();
    }

    // ---------------------------
    // Flower rendering
    // Unwind longer: petals are drawn as spiral "ribbons" that expand
    // ---------------------------
    function drawStem(base, tip, tGrow, thickness){
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      const x0 = base.x, y0 = base.y;
      const x1 = tip.x,  y1 = tip.y;

      // slight curve control
      const cx = lerp(x0, x1, 0.35) + (x1-x0)*0.1;
      const cy = lerp(y0, y1, 0.35) - 120;

      const steps = 90;
      ctx.beginPath();
      for(let i=0;i<=steps;i++){
        const tt = (i/steps) * tGrow;
        const x = (1-tt)*(1-tt)*x0 + 2*(1-tt)*tt*cx + tt*tt*x1;
        const y = (1-tt)*(1-tt)*y0 + 2*(1-tt)*tt*cy + tt*tt*y1;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.strokeStyle = "#16784a";
      ctx.lineWidth = thickness;
      ctx.stroke();

      ctx.strokeStyle = "#2bb36a";
      ctx.lineWidth = thickness*0.55;
      ctx.stroke();
    }

    function drawLeaf(p0, p1, width, color, outlineAlpha=0.12){
      const dx = p1.x - p0.x, dy = p1.y - p0.y;
      const len = Math.hypot(dx, dy) || 1;
      const ux = dx/len, uy = dy/len;
      const nx = -uy, ny = ux;

      const pts = [];
      const steps = 28;
      for(let i=0;i<=steps;i++){
        const t=i/steps;
        const w=width*Math.sin(Math.PI*t);
        pts.push({x:p0.x+dx*t+nx*w, y:p0.y+dy*t+ny*w});
      }
      for(let i=steps;i>=0;i--){
        const t=i/steps;
        const w=width*Math.sin(Math.PI*t);
        pts.push({x:p0.x+dx*t-nx*w, y:p0.y+dy*t-ny*w});
      }

      ctx.beginPath();
      ctx.moveTo(pts[0].x, pts[0].y);
      for(const p of pts) ctx.lineTo(p.x,p.y);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();

      ctx.globalAlpha = outlineAlpha;
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.globalAlpha = 1;
    }

    function drawSpiralBloom(center, bloom, palette, twist, petalCount=18){
      // bloom in [0..1] controls how much spiral is revealed
      // We draw multiple "petal ribbons" as spirals expanding outward.
      const reveal = smoothstep(bloom);
      const maxTurns = 3.4;              // longer unwind feel
      const turns = lerp(0.0, maxTurns, reveal);
      const maxR = lerp(12, 150, reveal);

      // petal ribbons
      for(let i=0;i<petalCount;i++){
        const baseAng = (i/petalCount)*Math.PI*2 + twist;
        const ribbon = i % 3; // vary thickness/opacity
        const ribbonAlpha = ribbon===0 ? 0.95 : (ribbon===1 ? 0.78 : 0.62);
        const strokeW = ribbon===0 ? 14 : (ribbon===1 ? 10 : 7);

        ctx.save();
        ctx.globalAlpha = ribbonAlpha;

        const grad = ctx.createRadialGradient(center.x, center.y, 8, center.x, center.y, maxR+40);
        grad.addColorStop(0, palette.inner);
        grad.addColorStop(0.55, palette.mid);
        grad.addColorStop(1, palette.outer);

        ctx.strokeStyle = grad;
        ctx.lineWidth = strokeW;
        ctx.lineCap = "round";

        ctx.beginPath();
        const steps = 220;
        for(let s=0;s<=steps;s++){
          const t = s/steps;
          const theta = baseAng + (turns * 2*Math.PI) * t;
          const r = (maxR) * (t**0.85);
          // slight waviness makes it feel like "unwinding"
          const wob = 1 + 0.06*Math.sin(7*t*2*Math.PI + i);
          const x = center.x + Math.cos(theta) * r * wob;
          const y = center.y + Math.sin(theta) * r * wob;

          if(s===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();

        // subtle highlight
        ctx.globalAlpha = ribbonAlpha*0.35;
        ctx.strokeStyle = "rgba(255,255,255,0.65)";
        ctx.lineWidth = Math.max(2, strokeW*0.22);
        ctx.stroke();

        ctx.restore();
      }

      // flower center
      const cr = lerp(8, 30, reveal);
      const centerGrad = ctx.createRadialGradient(center.x-6, center.y-6, 4, center.x, center.y, cr+20);
      centerGrad.addColorStop(0, "#fff1b8");
      centerGrad.addColorStop(1, "#ffcb59");
      ctx.fillStyle = centerGrad;
      ctx.beginPath();
      ctx.arc(center.x, center.y, cr, 0, Math.PI*2);
      ctx.fill();

      ctx.strokeStyle = "rgba(200,120,30,0.55)";
      ctx.lineWidth = 4;
      ctx.stroke();

      // pollen dots
      for(let k=0;k<16;k++){
        const a = (k/16)*Math.PI*2;
        const rr = cr*0.72 + 3*Math.sin(performance.now()/450 + k);
        const x = center.x + Math.cos(a)*rr;
        const y = center.y + Math.sin(a)*rr;
        ctx.fillStyle = "rgba(190,120,35,0.88)";
        ctx.beginPath();
        ctx.arc(x,y, 2.6, 0, Math.PI*2);
        ctx.fill();
      }
    }

    // ---------------------------
    // Scene: 3 flowers, full-screen
    // ---------------------------
    const palettes = {
      pink:   { inner:"rgba(255,210,235,1)", mid:"rgba(255,120,190,1)", outer:"rgba(255,70,160,1)" },
      red:    { inner:"rgba(255,210,210,1)", mid:"rgba(255,110,120,1)", outer:"rgba(235,40,70,1)"  },
      yellow: { inner:"rgba(255,250,210,1)", mid:"rgba(255,225,120,1)", outer:"rgba(255,195,60,1)"  }
    };

    function layoutFlowers(){
      const w = window.innerWidth;
      const h = window.innerHeight;

      // positions feel nice on both desktop + mobile
      return [
        {
          color: palettes.yellow,
          base: {x: w*0.22, y: h*1.08},
          tip:  {x: w*0.28, y: h*0.52},
          bloomCenter: {x: w*0.30, y: h*0.48},
          twist: 0.3,
          delay: 0.00
        },
        {
          color: palettes.pink,
          base: {x: w*0.52, y: h*1.10},
          tip:  {x: w*0.52, y: h*0.42},
          bloomCenter: {x: w*0.52, y: h*0.38},
          twist: 0.9,
          delay: 0.35
        },
        {
          color: palettes.red,
          base: {x: w*0.82, y: h*1.06},
          tip:  {x: w*0.74, y: h*0.54},
          bloomCenter: {x: w*0.72, y: h*0.50},
          twist: 1.6,
          delay: 0.70
        }
      ];
    }

    let flowers = layoutFlowers();
    window.addEventListener('resize', ()=>{ resize(); flowers = layoutFlowers(); });

    // Longer unwind timings
    const STEM_DUR = 3.6;     // longer growth
    const BLOOM_DUR = 6.8;    // longer unwind bloom
    const UI_TIME = STEM_DUR + BLOOM_DUR + 0.8;

    const t0 = performance.now();

    function drawFrame(now){
      const t = (now - t0) / 1000;

      // background
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      // dreamy gradient overlay
      const bg = ctx.createRadialGradient(
        window.innerWidth*0.25, window.innerHeight*0.25, 80,
        window.innerWidth*0.55, window.innerHeight*0.55, Math.max(window.innerWidth, window.innerHeight)
      );
      bg.addColorStop(0, "rgba(255,255,255,1)");
      bg.addColorStop(0.45, "rgba(255,240,248,1)");
      bg.addColorStop(1, "rgba(255,224,240,1)");
      ctx.fillStyle = bg;
      ctx.fillRect(0,0,window.innerWidth,window.innerHeight);

      // tiny hearts drifting (canvas)
      for(let i=0;i<22;i++){
        const x = (i*97 + (t*18)) % (window.innerWidth + 120) - 60;
        const y = (window.innerHeight*0.15) + (i*33 % 240) + 22*Math.sin(t*1.1 + i);
        drawTinyHeart(x, y, 10 + (i%4)*2, 0.35*Math.sin(t + i), 0.08 + (i%5)*0.012, (i%2? "#ff4fa4":"#ff8bc8"));
      }

      // draw flowers
      for(const f of flowers){
        const localT = Math.max(0, t - f.delay);

        // stem growth
        const stemT = smoothstep(localT / STEM_DUR);

        // draw stem
        drawStem(f.base, f.tip, stemT, 26);

        // leaves appear mid-stem
        const leafT = smoothstep((stemT - 0.3) / 0.7);
        if (leafT > 0.02){
          const pA = { x: lerp(f.base.x, f.tip.x, 0.62), y: lerp(f.base.y, f.tip.y, 0.62) };
          const pB = { x: lerp(f.base.x, f.tip.x, 0.76), y: lerp(f.base.y, f.tip.y, 0.76) };

          drawLeaf(pA, {x: pA.x - 220*leafT, y: pA.y - 70*leafT}, 62*leafT, "#2aa45f");
          drawLeaf(pB, {x: pB.x + 240*leafT, y: pB.y - 55*leafT}, 58*leafT, "#239857");
        }

        // bloom starts slightly before stem ends for "unwind" vibe
        const bloomStart = STEM_DUR*0.65;
        const bloomT = smoothstep((localT - bloomStart) / BLOOM_DUR);

        // sway
        const sway = 0.06*Math.sin(t*0.9 + f.twist) + 0.03*Math.sin(t*1.4 + f.twist*2);
        const bloomCenter = { x: f.bloomCenter.x, y: f.bloomCenter.y };

        drawSpiralBloom(bloomCenter, bloomT, f.color, f.twist + sway, 18);
      }

      // show UI after everything blooms
      if (t > UI_TIME) ui.classList.add('show');

      requestAnimationFrame(drawFrame);
    }
    requestAnimationFrame(drawFrame);

    // ---------------------------
    // YES button celebration
    // ---------------------------
    const yesBtn = document.getElementById('yesBtn');
    const accepted = document.getElementById('accepted');

    function popHearts(x,y, n=70){
      for(let i=0;i<n;i++){
        const h = document.createElement('div');
        h.className = 'pop-heart';
        const size = 10 + Math.random()*16;
        h.style.width = size+'px';
        h.style.height = size+'px';

        const colors = ['#ff4fa4','#ff78bd','#ff3b7d','#ff9ad0','#ffd1e7','#ffd25a'];
        h.style.background = colors[(Math.random()*colors.length)|0];

        let px = x, py = y;
        const ang = Math.random()*Math.PI*2;
        const spd = 3 + Math.random()*7;
        let vx = Math.cos(ang)*spd;
        let vy = Math.sin(ang)*spd - (6 + Math.random()*3);

        const gravity = 0.16 + Math.random()*0.10;
        let life = 95 + (Math.random()*75|0);

        h.style.left = (px - size/2) + 'px';
        h.style.top  = (py - size/2) + 'px';
        document.body.appendChild(h);

        function step(){
          life--;
          vy += gravity;
          px += vx;
          py += vy;

          h.style.left = (px - size/2) + 'px';
          h.style.top  = (py - size/2) + 'px';
          h.style.opacity = (life/170).toFixed(2);

          if(life>0) requestAnimationFrame(step);
          else h.remove();
        }
        requestAnimationFrame(step);
      }
    }

    let clicked = false;
    yesBtn.addEventListener('click', ()=>{
      if(clicked) return;
      clicked = true;

      yesBtn.textContent = "YAY! üíû";
      accepted.classList.add('show');

      const r = yesBtn.getBoundingClientRect();
      popHearts(r.left + r.width/2, r.top + r.height/2, 90);
    });
  </script>
</body>
</html>
